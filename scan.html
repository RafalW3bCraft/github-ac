<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mythic Eyes: Emotion Awakening</title>
<style>
body{margin:0;overflow:hidden;background:#000;color:#fff;font-family:sans-serif}
video,canvas{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
#video{transform:scaleX(-1)} /* mirror selfie */
#status{position:fixed;top:8px;left:50%;transform:translateX(-50%);
  background:#0008;padding:6px 10px;border-radius:8px;font-size:14px}
</style>
</head>
<body>
<video id="video" autoplay playsinline muted></video>
<canvas id="fx"></canvas>
<div id="status">Loadingâ€¦</div>

<script type="module">
import {FaceLandmarker, FilesetResolver} from 
  "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/vision_bundle.mjs";

const video=document.getElementById("video");
const fx=document.getElementById("fx");
const ctx=fx.getContext("2d");
const status=document.getElementById("status");

let landmarker,lastVideoTime=0;

async function initFace(){
  const fileset=await FilesetResolver.forVisionTasks(
    "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm");
  landmarker=await FaceLandmarker.createFromOptions(fileset,{
    baseOptions:{modelAssetPath:
      "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm/face_landmarker.task"},
    runningMode:"VIDEO",numFaces:1,outputFaceBlendshapes:true
  });
  status.textContent="Face model ready";
}

async function openCamera(){
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});
    video.srcObject=stream;
    video.onloadedmetadata=()=>{
      video.play();
      fx.width=video.videoWidth; fx.height=video.videoHeight;
      status.textContent="Camera ready";
      requestAnimationFrame(loop);
    };
  }catch(e){status.textContent="Camera denied";}
}

function renderEyes(landmarks){
  ctx.clearRect(0,0,fx.width,fx.height);
  if(!landmarks?.length) return;
  const pts=landmarks[0];
  const L=pts[468]||pts[159],R=pts[473]||pts[386];
  if(!L||!R) return;
  const lx=L.x*fx.width,ly=L.y*fx.height;
  const rx=R.x*fx.width,ry=R.y*fx.height;
  drawGlow(lx,ly,"#ffd166");
  drawGlow(rx,ry,"#ffd166");
}
function drawGlow(x,y,color){
  const r=30,g=ctx.createRadialGradient(x,y,5,x,y,r);
  g.addColorStop(0,color); g.addColorStop(1,"transparent");
  ctx.fillStyle=g; ctx.beginPath(); ctx.arc(x,y,r,0,2*Math.PI); ctx.fill();
}

function loop(){
  if(video.readyState>=2&&landmarker){
    if(video.currentTime!==lastVideoTime){
      lastVideoTime=video.currentTime;
      const res=landmarker.detectForVideo(video,performance.now());
      renderEyes(res.faceLandmarks);
    }
  }
  requestAnimationFrame(loop);
}

(async function(){
  await initFace();
  await openCamera();
})();
</script>
</body>
</html>
